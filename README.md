# [Snipp Link]

**Snipp Link**ëŠ” ê¸´ ì›¹ ì£¼ì†Œë¥¼ ì§§ê³  ê°„ê²°í•œ URLë¡œ ë‹¨ì¶•í•˜ê³ , ì´ì— ëŒ€í•œ ì ‘ê·¼ í†µê³„ ë° ë³´ì•ˆ ì„¤ì •ì„ ì œê³µí•˜ëŠ” **URL ë‹¨ì¶• ê´€ë¦¬ ì†”ë£¨ì…˜**ìž…ë‹ˆë‹¤.

---

## ðŸ“– H2 Console ì ‘ì† ë°©ë²• (Local)

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ H2 Database Consoleì— ì ‘ì†í•˜ëŠ” ë°©ë²•ìž…ë‹ˆë‹¤.

- **ì ‘ì† ì£¼ì†Œ**: [http://localhost:8083/h2-console](http://localhost:8083/h2-console)
- **JDBC URL**: `jdbc:h2:file:~/snipp_link;MODE=MariaDB;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE`
- **User Name**: `sa`
- **Password**: (ë¹ˆ ê°’)

---

## âš™ï¸ Redis ì„¤ì •

1. **redis.conf íŒŒì¼ ì„¤ì •**
   - ê¸°ì¡´ ì„¤ì • ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì„¤ì¹˜ ê²½ë¡œì— ì ìš©í•©ë‹ˆë‹¤.

2. **ì €ìž¥ì†Œ í´ë” ìƒì„±**
   - `Dë“œë¼ì´ë¸Œ` ê²½ë¡œì— `redisData` í´ë”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

3. **PowerShell ì‹¤í–‰ ë° ì„œë²„ êµ¬ë™**
   - PowerShellì„ ì—´ì–´ í•´ë‹¹ ë ˆë””ìŠ¤ ì„¤ì¹˜ ê²½ë¡œë¡œ ì´ë™í•©ë‹ˆë‹¤.
   - ì˜ˆì‹œ: `cd D:\redis-7.0.11-windows\`
   - ì‹¤í–‰ ëª…ë ¹ì–´ ìž…ë ¥:
     ```powershell
     .\redis-server.exe redis.conf
     ```

4. **Redis ê´€ë¦¬ ë° ë¡œê·¸ ì²´í¬**
   - **(1) redis-cli ì ‘ì†**
     ```powershell
     .\redis-cli
     ```
   - **(2) redis key ëª©ë¡ ì¡°íšŒ**
     ```bash
     127.0.0.1:6379> keys auth:*
     ```
   - **(3) ê° í‚¤ ì •ë³´ê°’ ì¡°íšŒ (JWT í† í° í™•ì¸)**
     ```bash
     127.0.0.1:6379> get auth:access:{userId}
     ```
   - **(4) ë°ì´í„° ì „ì²´ ì‚­ì œ (ì´ˆê¸°í™”)**
     ```bash
     127.0.0.1:6379> flushall
     ```

---

## ðŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° ë° í•µì‹¬ ê¸°ëŠ¥

ë³¸ í”„ë¡œì íŠ¸ëŠ” ë„ë©”ì¸í˜• ë””ë ‰í„°ë¦¬ êµ¬ì¡°(`domain`, `global`)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, í™•ìž¥ì„± ìžˆëŠ” **Stateless ì¸ì¦ ì „ëžµ**ì„ í•µì‹¬ ì•„í‚¤í…ì²˜ë¡œ ì±„íƒí•˜ê³  ìžˆìŠµë‹ˆë‹¤.

### 0. ðŸ—„ï¸ íŒ¨í‚¤ì§€ êµ¬ì¡° ìƒì„¸ ì„¤ëª…

ë³¸ í”„ë¡œì íŠ¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì‘ì§‘ë„ë¥¼ ë†’ì´ê³  ìœ ì§€ë³´ìˆ˜ë¥¼ ìš©ì´í•˜ê²Œ í•˜ê¸° ìœ„í•´ **ë„ë©”ì¸ ê¸°ë°˜ ë””ë ‰í„°ë¦¬ êµ¬ì¡°**ë¥¼ ì±„íƒí•˜ê³  ìžˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ëŠ” í¬ê²Œ ê° ê¸°ëŠ¥ë³„ë¡œ ë…ë¦½ì ì¸ ê³„ì¸µì„ ê°–ëŠ” `domain` ì˜ì—­ê³¼ ì‹œìŠ¤í…œ ì „ì—­ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” `global` ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

#### 1. ðŸ—ï¸ ë„ë©”ì¸ ì˜ì—­ (`domain`)
ê° ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ëŠ¥(ì˜ˆ: `bbs`, `shorturl`, `snipp`, `user` ë“±)ë³„ë¡œ í´ë”ë¥¼ ìƒì„±í•˜ê³ , í•´ë‹¹ ë„ë©”ì¸ì„ êµ¬ë™í•˜ê¸° ìœ„í•œ ëª¨ë“  ê³„ì¸µì„ í•˜ìœ„ì— ì‘ì§‘ì‹œí‚¨ í˜•íƒœìž…ë‹ˆë‹¤.

* **`controller`**: ì‚¬ìš©ìž ìš”ì²­ì„ ë°›ëŠ” ì§„ìž…ì ìž…ë‹ˆë‹¤. í™”ë©´ ë Œë”ë§ì„ ìœ„í•œ `@Controller`ì™€ API ì‘ë‹µì„ ìœ„í•œ `api` íŒ¨í‚¤ì§€ í•˜ìœ„ì˜ `@RestController`ë¥¼ ëª…í™•ížˆ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.
* **`service`**: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ íŠ¸ëžœìž­ì…˜(`@Transactional`)ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
* **`dao` (Data Access Object)**: MyBatis ë§¤í¼ ì¸í„°íŽ˜ì´ìŠ¤(`Mapper`)ì™€ SQL ì¿¼ë¦¬ê°€ ë‹´ê¸´ `XML` íŒŒì¼ì„ ë™ì¼ íŒ¨í‚¤ì§€ì— ë‘ì–´ ê´€ë¦¬ì˜ íŽ¸ì˜ì„±ê³¼ ì½”ë“œ ì‘ì§‘ë„ë¥¼ ë†’ì˜€ìŠµë‹ˆë‹¤.
* **`dto` (Data Transfer Object)**: ê³„ì¸µ ê°„ ë°ì´í„° ì „ì†¡ì„ ìœ„í•œ ê°ì²´ìž…ë‹ˆë‹¤.
    * `request`: ë°ì´í„° ë“±ë¡(`Save`), ìˆ˜ì •(`Change`), ì¡°íšŒ ì¡°ê±´(`Param`) ë“± í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ë°ì´í„°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    * `response`: ëª©ë¡ ì¡°íšŒ(`List`), ìƒì„¸ ë‚´ì—­(`View`) ë“± í´ë¼ì´ì–¸íŠ¸ë¡œ ë°˜í™˜í•  ì‘ë‹µ ë°ì´í„°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
* **`entity`**: ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ 1:1ë¡œ ë§¤í•‘ë˜ëŠ” ë„ë©”ì¸ ëª¨ë¸ ê°ì²´ìž…ë‹ˆë‹¤.

#### 2. ðŸŒ ê¸€ë¡œë²Œ ì˜ì—­ (`global`)
í”„ë¡œì íŠ¸ ì „ì—­ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì„¤ì •, ë³´ì•ˆ, ì¸í”„ë¼ ê´€ë ¨ ê¸°ëŠ¥ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

* **`config`**: `MyBatisConfig`, `SecurityConfig` ë“± ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í•µì‹¬ ì„¤ì •ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
* **`auth` / `jwt`**: JWT ê¸°ë°˜ì˜ ì¸ì¦ ì „ëžµê³¼ ê¶Œí•œ ê²€ì¦ ë¡œì§ì„ í¬í•¨í•©ë‹ˆë‹¤.
* **`exception` / `handler`**: ì»¤ìŠ¤í…€ ì˜ˆì™¸(`CustomException`) ë° ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬(`GlobalExceptionHandler`)ë¥¼ í†µí•´ ì •êµí•œ ì—ëŸ¬ í•¸ë“¤ë§ì„ ì œê³µí•©ë‹ˆë‹¤.
* **`interceptor`**: ìš”ì²­ ì „í›„ì˜ ë¡œê¹…, ê¶Œí•œ ì²´í¬ ë“±ì„ ìˆ˜í–‰í•˜ëŠ” ì¸í„°ì…‰í„°ê°€ ì •ì˜ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
* **`util`**: ë‚ ì§œ ì²˜ë¦¬, ë¬¸ìžì—´ ê°€ê³µ ë“± í”„ë¡œì íŠ¸ ì „ë°˜ì—ì„œ ì“°ì´ëŠ” ìœ í‹¸ë¦¬í‹° í´ëž˜ìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

### 1. ðŸ”— URL Shortening (í•µì‹¬ ì„œë¹„ìŠ¤)
ê¸´ URLì„ ê³ ìœ  í‚¤ ê¸°ë°˜ì˜ ë‹¨ì¶• URLë¡œ ë³€í™˜í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤.
- **ì„œë¹„ìŠ¤ ì˜ˆì‹œ**:
   - *Original*: `https://shop.coupang.com/A00055365/238868?source=...`
   - *Shortened*: `http://localhost:8083/snipp-short/Qtd39pl`
- **ë¶€ê°€ ê¸°ëŠ¥**:
   - ë‚´ ë‹¨ì¶• URL ì ‘ê·¼ í†µê³„ í™•ì¸ ë° ë¡œê·¸ ì¶”ì  (ì§„í–‰ ì¤‘)
   - íŠ¹ì • ìœ ì €ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ ì„¤ì • ë° ìœ íš¨ ê¸°ê°„ ê´€ë¦¬

### 2. ðŸ” JWT + Redis ê¸°ë°˜ ì¸ì¦ ë° ë³´ì•ˆ
ê¸°ì¡´ ì„¸ì…˜ ë°©ì‹ì—ì„œ **JWT + Redis** ë¬´ìƒíƒœ ì¸ì¦ ë°©ì‹ìœ¼ë¡œ ê³ ë„í™”í–ˆìŠµë‹ˆë‹¤.
- **í•˜ì´ë¸Œë¦¬ë“œ ë¡œê·¸ì¸**: í¼ ë¡œê·¸ì¸ê³¼ ì†Œì…œ ë¡œê·¸ì¸(Google, Kakao, Naver)ì„ í†µí•© ì§€ì›.
- **ì¤‘ë³µ ë¡œê·¸ì¸ ë°©ì§€**: Redisì— ìµœì‹  ë°œê¸‰ í† í°ì„ ì €ìž¥/ëŒ€ì¡°í•˜ì—¬ ë™ì¼ ê³„ì • ì ‘ì† ì‹œ ì´ì „ ì„¸ì…˜ì„ ë§Œë£Œì‹œí‚¤ëŠ” **'ë°€ì–´ë‚´ê¸°'** ë¡œì§ êµ¬í˜„.
- **ë³´ì•ˆ ì„¤ì • (Security)**:
   - **CSRF ë¹„í™œì„±í™”**: JWTë¥¼ `Authorization` í—¤ë”ì— ë‹´ì•„ ì „ì†¡í•˜ëŠ” ë¬´ìƒíƒœ êµ¬ì¡°ì´ë¯€ë¡œ CSRF ë³´ì•ˆì„ ë¹„í™œì„±í™”í•˜ì—¬ í†µì‹  íš¨ìœ¨ì„ ë†’ì´ê³  Thymeleaf í…œí”Œë¦¿ ì˜ì¡´ì„±ì„ ì œê±°í•¨.
   - **ê¶Œí•œ ì œì–´ (Paths ê¸°ë°˜)**: `Paths.java`ì— ì •ì˜ëœ ë§¤ì²˜ë¥¼ í†µí•´ ì—­í• ë³„ ì ‘ê·¼ ì œí•œì„ ì¤‘ì•™ ê´€ë¦¬í•¨.
      - **ë¡œê·¸ì¸ ì´ì „**: `/snipp/**`, `/api/snipp/**`, `/snipp-short/**` ë“± ê¸°ë³¸ ì ‘ê·¼ í—ˆìš©
      - **SUPER ê¶Œí•œ**: `/snipp/**/super/**`, `/api/snipp/**/super/**`
      - **MANAGER ê¶Œí•œ**: `/snipp/**/manager/**`, `/api/snipp/**/manager/**`

### 3. ðŸ›¡ï¸ ì»¤ìŠ¤í…€ ì˜ˆì™¸ í•¸ë“¤ë§ (Exception Handling)
ì¸ì¦ ë° ì¸ê°€ ì˜¤ë¥˜ë¥¼ AJAXì™€ ì¼ë°˜ ìš”ì²­ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì •êµí•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **401 (CustomAuthenticationHandler)**: ì¸ì¦ ì‹¤íŒ¨ ì‹œ JSON ì‘ë‹µ ë˜ëŠ” ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬.
- **403 (CustomAccessDeniedHandler)**: ê¶Œí•œ ë¶€ì¡± ì‹œ ê³µí†µ ì—ëŸ¬ ì‘ë‹µ ê°ì²´(`ErrorResponse`)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. (CSRF ì²´í¬ ë¡œì§ ì œê±° ë° ìˆœìˆ˜ ì¸ê°€ ì˜¤ë¥˜ ì§‘ì¤‘)

### 4. ðŸŽ¨ í™”ë©´ ë Œë”ë§ ë° í´ë¼ì´ì–¸íŠ¸ í†µì‹ 
- **Thymeleaf (SSR)**: í˜„ìž¬ SSRì„ ì´ìš© ì¤‘ì´ë©°, CSRF í† í°ì„ ì œê±°í•˜ì—¬ ì¶”í›„ React/Vue ë“± CSR í™˜ê²½ ì „í™˜ì´ ìš©ì´í•˜ë„ë¡ ì„¤ê³„ë¨.
- **Http.js (Ajax Retry)**: í† í° ë§Œë£Œ ì‹œ `/api/auth/refresh`ë¥¼ í†µí•´ ìžë™ ìž¬ë°œê¸‰ ë° ì‹¤íŒ¨ ìš”ì²­ ìž¬ì‹œë„ ë¡œì§ êµ¬í˜„.
- **Global Model**: `@ControllerAdvice`ë¥¼ í™œìš©í•´ ëª¨ë“  íŽ˜ì´ì§€ì—ì„œ `isLogin`, `isSuper`, `loginUid` ë“±ì˜ ìƒíƒœê°’ì„ ê³µí†µ ëª¨ë¸ë¡œ ì£¼ìž…í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## ðŸ›  ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)

| Category | Technology |
| :--- | :--- |
| **Language** | Java 17 |
| **Framework** | Spring Boot 3.4.4 |
| **Database** | MariaDB -> H2 (Local Development) |
| **NoSQL** | **Redis** (Token & SSO ê´€ë¦¬) |
| **View** | Thymeleaf, JavaScript (jQuery) |
| **Security** | Spring Security 6, OAuth2 Client, **JWT** |
| **ORM** | MyBatis |